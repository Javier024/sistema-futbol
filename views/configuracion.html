<!DOCTYPE html>
<html lang="es">
<head><meta charset="UTF-8"><title>Configuración</title><link rel="stylesheet" href="../assets/css/styles.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"></head>
<body><div id="app-layout"><div id="sidebar-placeholder"></div><main><header><h1>Configuración</h1></header><div id="view-container"></div></main></div><div id="toast-container"></div>
<script src="../assets/js/common.js"></script><script>
window.addEventListener('DOMContentLoaded', () => { if(!checkAuth()) return; renderSidebar('configuracion'); loadC(); });
function loadC() { const cf = db.getAll('configuracion_sistema')[0]; const ad = db.getAll('usuarios')[0]; document.getElementById('view-container').innerHTML = `<div class="grid-2"><div class="card"><h3>Datos Escuela</h3><form onsubmit="svC(event)"><div class="form-group"><label>Nombre</label><input id="n" value="${cf.nombre_escuela}"></div><div class="form-group"><label>Valor</label><input type="number" id="v" value="${cf.valor_mensual}"></div><div class="form-group"><label>Moneda</label><select id="m"><option value="COP" ${cf.moneda==='COP'?'selected':''}>COP</option><option value="USD" ${cf.moneda==='USD'?'selected':''}>USD</option></select></div><button class="btn btn-primary btn-block">Actualizar</button></form></div><div class="card"><h3>Seguridad</h3><form onsubmit="svAd(event)"><div class="form-group"><label>Correo</label><input id="ae" value="${ad.correo}"></div><div class="form-group"><label>Clave</label><input id="ap" value="${ad.hash_contrasena}"></div><button class="btn btn-secondary btn-block">Cambiar</button></form><hr><h4>Backup</h4><button class="btn btn-accent btn-block" style="margin-bottom:10px;" onclick="dlBk()">Descargar</button><div style="position:relative;overflow:hidden;display:inline-block;width:100%;"><button class="btn btn-secondary btn-block">Restaurar</button><input type="file" accept=".json" onchange="rsBk(this)" style="position:absolute;left:0;top:0;opacity:0;width:100%;height:100%;cursor:pointer;"></div></div></div>`; }
const svC = (e) => { e.preventDefault(); const cf = db.getAll('configuracion_sistema')[0]; db.update('configuracion_sistema',cf.id,{nombre_escuela:document.getElementById('n').value,valor_mensual:document.getElementById('v').value,moneda:document.getElementById('m').value}); showToast('Guardado'); };
const svAd = (e) => { e.preventDefault(); const ad = db.getAll('usuarios')[0]; db.update('usuarios',ad.id,{correo:document.getElementById('ae').value,hash_contrasena:document.getElementById('ap').value}); showToast('Actualizado'); };
const dlBk = () => { const d="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(db.data)); const l=document.createElement("a"); l.href=d; l.download=`bk_${new Date().toISOString().split('T')[0]}.json`; document.body.appendChild(l); l.click(); showToast('Descargado'); };
const rsBk = (i) => { const f = i.files[0]; if(!f) return; const r = new FileReader(); r.onload=(e)=>{ try{ const d=JSON.parse(e.target.result); if(!d.jugadores) throw 'Err'; if(confirm('Reemplazar todo?')){ db.data=d; db.save(); showToast('Restaurado'); setTimeout(()=>location.reload(),1500); } }catch(err){ showToast('Error','error'); } }; r.readAsText(f); i.value=''; };
</script></body></html>