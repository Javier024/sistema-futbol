<!DOCTYPE html>
<html lang="es">
<head><meta charset="UTF-8"><title>Alertas</title><link rel="stylesheet" href="../assets/css/styles.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"></head>
<body><div id="app-layout"><div id="sidebar-placeholder"></div><main><header><h1>Alertas</h1></header><div id="view-container" style="flex:1;"></div></main></div><div id="toast-container"></div>
<script src="../assets/js/common.js"></script><script>
window.addEventListener('DOMContentLoaded', () => { if(!checkAuth()) return; renderSidebar('alertas'); loadA(); });
function loadA() { const pl = db.getAll('jugadores'); const td = new Date(); const CD = 5; let ov=[], wa=[], de=[]; pl.forEach(p => { const s = finance.getPlayerStatus(p.id); const iso = (s.status==='debt'||s.status==='partial') && td.getDate()>CD; if(iso) ov.push({p,s,t:'VENCIDO'}); else if(td.getDate()<=CD && s.status!=='paid') wa.push({p,s,t:'POR VENCER'}); else if(s.status!=='paid') de.push({p,s,t:'DEUDA'}); }); const rn = (l,c) => l.length?l.map(i=>`<div style="background:var(--bg-card);padding:15px;margin-bottom:10px;border-left:5px solid ${c};display:flex;justify-content:space-between;"><div><b>${i.p.nombres} ${i.p.apellidos}</b><br><small>Debe: ${utils.formatMoney(i.s.debt)}</small></div><button class="btn btn-sm btn-accent" onclick="wa(${i.p.id},'${i.t}',${i.s.debt})"><i class="fab fa-whatsapp"></i></button></div>`).join(''):'<div style="text-align:center;padding:10px;">Ninguno</div>'; document.getElementById('view-container').innerHTML = `<div class="card"><h3>Alertas</h3><h4 style="color:var(--danger)">Vencidos</h4>${rn(ov,'var(--danger)')}<h4 style="color:var(--warning)">Por Vencer</h4>${rn(wa,'var(--warning)')}<h4 style="color:var(--accent)">Deuda</h4>${rn(de,'var(--accent)')}</div>`; }
const wa = (pid,t,debt) => { const p = db.getById('jugadores', pid); const conf = db.getAll('configuracion_sistema')[0]; const ac = db.getById('acudientes', p.id_acudiente); const m = t==='VENCIDO'?`Hola ${ac?ac.nombre:p.nombres}, pago vencido. Deuda: ${utils.formatMoney(debt)}.`:`Hola ${ac?ac.nombre:p.nombres}, recordatorio pago: ${utils.formatMoney(debt)}.`; window.open(`https://wa.me/57${ac?ac.telefono:p.telefono}?text=${encodeURIComponent(m)}`,'_blank'); };
</script></body></html>