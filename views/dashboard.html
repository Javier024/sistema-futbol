<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Futbol Manager</title>
    <link rel="stylesheet" href="../assets/css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div id="app-layout">
        <div id="sidebar-placeholder"></div>
        <main>
            <header><h1>Dashboard General</h1><div id="date-display"></div></header>
            <div id="view-container" style="flex: 1;"></div>
        </main>
    </div>
    <div id="modal" class="modal-overlay"><div class="modal-box"><div class="modal-header"><h3 id="modal-title">Título</h3><button onclick="closeModal()" class="btn btn-sm btn-secondary"><i class="fas fa-times"></i></button></div><div id="modal-content"></div></div></div>
    <div id="toast-container"></div>
    <script src="../assets/js/common.js"></script>
    <script>
        window.addEventListener('DOMContentLoaded', () => { if(!checkAuth()) return; renderSidebar('dashboard'); document.getElementById('date-display').innerText = new Date().toLocaleDateString('es-CO', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }); loadDashboard(); });
        function loadDashboard() {
            const players = db.getAll('jugadores'); const payments = db.getAll('pagos'); const expenses = db.getAll('gastos'); const now = new Date();
            const income = payments.filter(p => new Date(p.fecha_pago).getMonth() === now.getMonth() && new Date(p.fecha_pago).getFullYear() === now.getFullYear()).reduce((sum, p) => sum + parseInt(p.monto), 0);
            const expense = expenses.filter(e => new Date(e.fecha_gasto).getMonth() === now.getMonth() && new Date(e.fecha_gasto).getFullYear() === now.getFullYear()).reduce((sum, e) => sum + parseInt(e.monto), 0);
            let paid = 0, debt = 0, partial = 0; players.forEach(p => { const s = finance.getPlayerStatus(p.id); if(s.status === 'paid') paid++; else if(s.status === 'partial') partial++; else debt++; });
            const html = `<div class="grid-4"><div class="kpi-card"><div class="kpi-label">Ingresos Mes</div><div class="kpi-value" style="color:var(--primary)">${utils.formatMoney(income)}</div></div><div class="kpi-card"><div class="kpi-label">Gastos Mes</div><div class="kpi-value" style="color:var(--danger)">${utils.formatMoney(expense)}</div></div><div class="kpi-card"><div class="kpi-label">Utilidad</div><div class="kpi-value" style="color:var(--text-main)">${utils.formatMoney(income - expense)}</div></div><div class="kpi-card"><div class="kpi-label">Jugadores</div><div class="kpi-value">${players.length}</div></div></div><div class="grid-2"><div class="chart-box"><h4 style="text-align:center; color:var(--text-main);">Estado Pagos</h4><div style="height:180px;"><canvas id="statusChart"></canvas></div></div><div class="chart-box"><h4 style="text-align:center; color:var(--text-main);">Flujo Caja</h4><div style="height:180px;"><canvas id="cashflowChart"></canvas></div></div></div>`;
            document.getElementById('view-container').innerHTML = html;
            new Chart(document.getElementById('statusChart'), { type: 'doughnut', data: { labels: ['Al día', 'Abono', 'Deuda'], datasets: [{ data: [paid, partial, debt], backgroundColor: ['#2ecc71', '#f1c40f', '#e74c3c'] }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } } });
            new Chart(document.getElementById('cashflowChart'), { type: 'bar', data: { labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun'], datasets: [{ label: 'Ingresos', data: [100000, 120000, 110000, 0, 0, 0], backgroundColor: '#2ecc71' }, { label: 'Gastos', data: [40000, 50000, 45000, 0, 0, 0], backgroundColor: '#e74c3c' }] }, options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true } }, plugins: { legend: { display: false } } } });
        }
    </script>
</body>
</html>